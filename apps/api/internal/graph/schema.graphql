# GraphQL schema for AI Aggregator

scalar Time
scalar UUID

# Job represents an AI processing request
type Job {
  id: UUID!
  tenantId: UUID!
  type: JobType!
  input: String!
  status: JobStatus!
  result: String
  error: String
  provider: String
  tokensIn: Int!
  tokensOut: Int!
  cost: Float!
  createdAt: Time!
  updatedAt: Time!
  startedAt: Time
  finishedAt: Time
}

enum JobType {
  TEXT
  IMAGE
}

enum JobStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

# Tenant represents an organization with API access
type Tenant {
  id: UUID!
  name: String!
  active: Boolean!
  createdAt: Time!
  updatedAt: Time!
}

# Provider represents an AI provider
type Provider {
  id: UUID!
  name: String!
  type: ProviderType!
  enabled: Boolean!
  priority: Int!
}

enum ProviderType {
  OPENAI
  CLAUDE
  LOCAL
  OLLAMA
}

# Usage represents resource consumption
type Usage {
  id: UUID!
  tenantId: UUID!
  jobId: UUID!
  provider: String!
  model: String
  tokensIn: Int!
  tokensOut: Int!
  cost: Float!
  createdAt: Time!
}

# UsageSummary represents aggregated usage statistics
type UsageSummary {
  provider: String!
  totalTokensIn: Int!
  totalTokensOut: Int!
  totalCost: Float!
  jobCount: Int!
}

# Pagination info
type PageInfo {
  totalCount: Int!
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
}

# Job connection for pagination
type JobConnection {
  edges: [JobEdge!]!
  pageInfo: PageInfo!
}

type JobEdge {
  node: Job!
  cursor: String!
}

# Input types
input CreateJobInput {
  type: JobType!
  input: String!
}

input JobsFilter {
  status: JobStatus
  type: JobType
}

input PaginationInput {
  limit: Int = 20
  offset: Int = 0
}

# Queries
type Query {
  # Get current authenticated tenant
  me: Tenant

  # Get a specific job by ID
  job(id: UUID!): Job

  # List jobs for the authenticated tenant
  jobs(filter: JobsFilter, pagination: PaginationInput): JobConnection!

  # Get usage summary for the authenticated tenant
  usageSummary: [UsageSummary!]!

  # List available providers
  providers: [Provider!]!
}

# Mutations
type Mutation {
  # Create a new AI job
  createJob(input: CreateJobInput!): Job!

  # Cancel a pending job
  cancelJob(id: UUID!): Job
}

# Subscriptions
type Subscription {
  # Subscribe to job status updates
  jobUpdated(id: UUID!): Job!
}
