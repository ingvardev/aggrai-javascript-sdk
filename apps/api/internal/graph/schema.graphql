# GraphQL schema for AI Aggregator

scalar Time
# scalar UUID - using ID instead

# Job represents an AI processing request
type Job {
  id: ID!
  tenantId: ID!
  type: JobType!
  input: String!
  status: JobStatus!
  result: String
  error: String
  provider: String
  tokensIn: Int!
  tokensOut: Int!
  cost: Float!
  createdAt: Time!
  updatedAt: Time!
  startedAt: Time
  finishedAt: Time
}

enum JobType {
  TEXT
  IMAGE
}

enum JobStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

# Tenant represents an organization with API access
type Tenant {
  id: ID!
  name: String!
  active: Boolean!
  defaultProvider: String
  settings: TenantSettings
  createdAt: Time!
  updatedAt: Time!
}

# TenantSettings represents user preferences
type TenantSettings {
  darkMode: Boolean!
  notifications: NotificationSettings!
}

type NotificationSettings {
  jobCompleted: Boolean!
  jobFailed: Boolean!
  providerOffline: Boolean!
  usageThreshold: Boolean!
  weeklySummary: Boolean!
  marketingEmails: Boolean!
}

# Provider represents an AI provider
type Provider {
  id: ID!
  name: String!
  type: ProviderType!
  enabled: Boolean!
  priority: Int!
}

enum ProviderType {
  OPENAI
  CLAUDE
  LOCAL
  OLLAMA
}

# Usage represents resource consumption
type Usage {
  id: ID!
  tenantId: ID!
  jobId: ID!
  provider: String!
  model: String
  tokensIn: Int!
  tokensOut: Int!
  cost: Float!
  createdAt: Time!
}

# UsageSummary represents aggregated usage statistics
type UsageSummary {
  provider: String!
  totalTokensIn: Int!
  totalTokensOut: Int!
  totalCost: Float!
  jobCount: Int!
}

# ProviderPricing represents pricing configuration for a provider model
type ProviderPricing {
  id: ID!
  provider: String!
  model: String!
  inputPricePerMillion: Float!
  outputPricePerMillion: Float!
  imagePrice: Float
  isDefault: Boolean!
  createdAt: Time!
  updatedAt: Time!
}

# Pagination info
type PageInfo {
  totalCount: Int!
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
}

# Job connection for pagination
type JobConnection {
  edges: [JobEdge!]!
  pageInfo: PageInfo!
}

type JobEdge {
  node: Job!
  cursor: String!
}

# Input types
input CreateJobInput {
  type: JobType!
  input: String!
}

input UpdateTenantInput {
  name: String
  defaultProvider: String
  settings: TenantSettingsInput
}

input TenantSettingsInput {
  darkMode: Boolean
  notifications: NotificationSettingsInput
}

input NotificationSettingsInput {
  jobCompleted: Boolean
  jobFailed: Boolean
  providerOffline: Boolean
  usageThreshold: Boolean
  weeklySummary: Boolean
  marketingEmails: Boolean
}

input CreatePricingInput {
  provider: String!
  model: String!
  inputPricePerMillion: Float!
  outputPricePerMillion: Float!
  imagePrice: Float
  isDefault: Boolean
}

input UpdatePricingInput {
  id: ID!
  inputPricePerMillion: Float!
  outputPricePerMillion: Float!
  imagePrice: Float
  isDefault: Boolean
}

input JobsFilter {
  status: JobStatus
  type: JobType
}

input PaginationInput {
  limit: Int = 20
  offset: Int = 0
}

# Model information from a provider
type ModelInfo {
  id: String!
  name: String!
  description: String
  maxTokens: Int
}

# Queries
type Query {
  # Get current authenticated tenant
  me: Tenant

  # Get a specific job by ID
  job(id: ID!): Job

  # List jobs for the authenticated tenant
  jobs(filter: JobsFilter, pagination: PaginationInput): JobConnection!

  # Get usage summary for the authenticated tenant
  usageSummary: [UsageSummary!]!

  # List available providers
  providers: [Provider!]!

  # List available models for a specific provider
  providerModels(provider: String!): [ModelInfo!]!

  # List all pricing configurations
  pricingList: [ProviderPricing!]!

  # List pricing for a specific provider
  pricingByProvider(provider: String!): [ProviderPricing!]!
}

# Mutations
type Mutation {
  # Create a new AI job
  createJob(input: CreateJobInput!): Job!

  # Cancel a pending job
  cancelJob(id: ID!): Job

  # Update current tenant settings
  updateTenant(input: UpdateTenantInput!): Tenant!

  # Create a new pricing configuration
  createPricing(input: CreatePricingInput!): ProviderPricing!

  # Update an existing pricing configuration
  updatePricing(input: UpdatePricingInput!): ProviderPricing!

  # Delete a pricing configuration
  deletePricing(id: ID!): Boolean!
}

# Subscriptions
type Subscription {
  # Subscribe to all job updates for the current tenant
  jobUpdated: Job!

  # Subscribe to updates for a specific job
  jobStatusChanged(jobId: ID!): Job!

  # Subscribe to usage summary updates for the current tenant
  usageUpdated: [UsageSummary!]!
}
